## Overview
This full-stack application for The Sandwich Project nonprofit streamlines sandwich collections, donations, and distributions. It provides comprehensive data management, analytics, and operational tools for volunteers, hosts, and recipients. The project aims to enhance data visibility, support organizational growth, and become a vital tool for food security initiatives, ultimately reducing food waste and hunger.

## User Preferences
Preferred communication style: Simple, everyday language.
UI Design: Button labels and interface text must be extremely clear about their function - avoid ambiguous labels like "Submit" in favor of specific action descriptions like "Enter New Data".
Form Design: Eliminate redundant or confusing form fields - host dialogs should have a single "Host Location Name" field instead of separate "Name" and "Host Location" fields.
Mobile UX Priority: Mobile user experience is critical - chat positioning and space efficiency are key concerns. Vehicle type should NOT be required for new driver entries.
Documentation: All technical findings and fixes must be documented in replit.md to avoid repeated searching and debugging.
Navigation Organization (Nov 2025): Reorganized "Planning & Coordination" section into three focused groups: (1) Event Planning for daily event scheduling operations, (2) Strategic Planning for long-term coordination (Projects, Meetings), (3) Analytics & Reports for insights and metrics. Moved Historical Import to Admin section as it's a data management tool. This reduces cognitive overload and groups functionality by workflow type. Added "Host Map" as a direct navigation item in Operations section for easy one-click access to the interactive host locations map (previously buried under Hosts → Locations tab → View Host Map button).
Date Display & Search Fix: When displaying OR searching dates from the database, always use `timeZone: 'UTC'` in toLocaleDateString() and UTC methods (getUTCMonth, getUTCDate, getUTCFullYear) to prevent timezone conversion bugs that cause off-by-one-day errors (e.g., `date.toLocaleDateString('en-US', { timeZone: 'UTC' })`). This applies to both display formatting AND search/filter logic.
Navigation Icons: Collections log icon in simple-nav should use sandwich logo.png from LOGOS folder.
Desktop Chat UX: Desktop users require proper scrolling behavior without nested scrolling containers that cause page focus issues - chat layout must handle desktop and mobile differently.
Analytics Philosophy: NEVER compare or rank hosts against each other. The Sandwich Project is about increasing volunteer turnout globally, not about which host reported more/less sandwiches. All host comparison features, "top performing hosts", "underperforming hosts", and similar language must be removed from analytics.
Activity Notifications UX: User activity displays must show meaningful action descriptions from the `details` field (e.g., "Updated user account settings", "Created new project") NOT generic actions+URLs (e.g., "View /dashboard"). The activity logger middleware generates detailed human-readable descriptions - always display these to users. Replace generic "Top Actions" lists with "Most Used Features" showing actual sections worked in.
Recipient Name Display Fix (Nov 2025): Fixed speaker/volunteer assignment storage to persist human-readable names instead of raw IDs. Root cause: When assigning speakers/volunteers, the code was storing raw IDs (e.g., "host-contact-4", "custom-1762134226512-David") in the `name` field of `speakerDetails`/`volunteerDetails`, and the display code simply echoed these technical identifiers. Solution: Updated assignment save logic in `client/src/components/event-requests/index.tsx` to resolve names BEFORE saving: (1) Custom IDs like "custom-1762134226512-David" extract to "David", (2) Host-contact IDs like "host-contact-4" look up the actual contact name from `hostsWithContacts`, (3) Regular user IDs look up full names from the users array. Display fallback logic in ScheduledCardEnhanced already handles legacy records by checking if the stored name is actually an ID and re-resolving it. Navigation: Made "Host Map" a nested sub-item of "Hosts" using `parentId` and `isSubItem` properties for better organization.
AI Intake Assistant UX (Nov 2025): Transformed AI assistant from passive information display into actionable workflow tool. Each recommendation, issue, and next step now displays smart action buttons that parse content keywords to show relevant actions (Edit Event, Log Contact, Schedule Call, Add Note). Buttons close dialog and open target form immediately. Added Communication & Notes consolidation - all notes/messages in single unified thread (initial request, contact attempts, planning/scheduling notes, all special requirement fields, social media notes) with proper icons and chronological sorting. Removed duplicate "MESSAGE FROM SUBMISSION:" section from NewRequestCard since the initial message now appears in the consolidated Communication & Notes thread. Extended scheduled event validation with critical checks for driver/speaker needs assessment, assignment tracking, and volunteer needs. AI now parses all notes fields for unstructured logistics information (driver/speaker/volunteer needs) that should be in structured fields, flagging these in recommendations. Location: `server/services/ai-intake-assistant/index.ts` contains 20+ extensible validation rules, `client/src/components/event-requests/dialogs/AiIntakeAssistantDialog.tsx` manages action routing, `client/src/components/event-message-thread.tsx` provides consolidated communication view.
AI Scheduling Date Constraint Fix (Nov 3, 2025): Fixed critical bug where AI Scheduling Assistant could recommend dates BEFORE the user's requested date. Root cause: The system extracted dates from message text (e.g., "we had an event on Oct 30") without filtering dates before the requested date, then AI/fallback heuristic could select earlier dates. Solution implemented in `server/services/ai-scheduling/index.ts`: (1) Removed "day before" as alternative option, (2) Added >= desired date filters for backup dates and message-extracted dates, (3) Updated system prompt with "CRITICAL CONSTRAINT: You may ONLY recommend dates on or after their originally requested date", (4) Added post-processing validation to reject dates before requested date and trigger fallback, (5) Updated user-facing prompt to clearly show originally requested date and mark it in options, (6) Added final filter ensuring all returned dates are >= desired date. This prevents scenarios like recommending October 30 for a November 18 request.

## System Architecture
The application features a React 18 frontend with TypeScript, Vite, TanStack Query, and Tailwind CSS (with shadcn/ui). The backend uses Express.js (TypeScript), Drizzle ORM, and PostgreSQL (Neon serverless), including session-based authentication. It uses environment variables for database separation, Winston for structured logging, and centralized CORS for security. The UI/UX adheres to The Sandwich Project's official color palette and Roboto typography, prioritizing clarity, responsiveness, and card-based dashboards.

**Key Technical Implementations & Features:**
-   **Authentication & Permissions**: Role-based access control, session management, password security, and a unified permissions system across frontend and backend.
-   **Data Management**: Comprehensive management of collections, hosts, recipients, users, and audit logs with Zod validation and timezone-safe date handling.
-   **Collection Log Data Architecture**: `sandwich_collections` table is the operational source of truth. Grant metrics are calculated directly from this log, including "Groups" entries.
-   **Search & Filtering**: Real-time capabilities across management interfaces.
-   **Performance Optimization**: Query optimization, caching, pagination, and database connection pooling.
-   **Messaging & Notifications**: Email (SendGrid), Socket.IO chat, SMS via Twilio, and dashboard notifications.
-   **Operational Tools**: Project, meeting, and work log management, user feedback, analytics dashboards, and a permissions-based Collection Walkthrough Tool.
-   **Meeting Management**: Full-featured system with agenda compilation, project integration, and PDF export.
-   **Event Requests Management System**: Tracking, duplicate detection, status tracking, Google Sheets integration, van driver staffing calculations, multi-recipient assignment, and comprehensive intake validation. Includes an interactive Leaflet map view with **toggle button for clustered view (organized) vs. all-pins view (impressive visual impact)**, intelligent marker clustering with custom TSP-branded teal gradient icons, color-coding by status, search/filter capabilities (search, category, year, status), and dual-layer geocoding (OpenStreetMap with Google Geocoding fallback). Clustering automatically groups nearby events and scales markers by count. Addresses are cleaned before geocoding. All event request creation paths (manual, Google Sheets, Excel, scheduled imports) have audit logging.
-   **Google Sheets Integration**: Bidirectional automatic synchronization for project tracker and event requests with duplicate prevention.
-   **User Activity Logging System**: Comprehensive tracking of authenticated user actions via middleware, displayed in User Management.
-   **Sandwich Type Tracking System**: Comprehensive tracking for individual and group collections with real-time validation and analytics.
-   **Interactive Route Map & Driver Optimization**: Leaflet map for visualizing host contact locations, route optimization, and driver assignment.
-   **Automated Reminders**: 24-hour volunteer reminder system via cron job.
-   **Team Board**: Commenting system with real-time counts and multi-user assignment.
-   **Email System**: Uses `katie@thesandwichproject.org` as the verified SendGrid sender with table-based HTML templates and BCC duplicate prevention.
-   **SMS Notifications**: Users can opt-in to SMS alerts, receiving assignment notifications (e.g., TSP contact for event requests). A one-time modal announces SMS availability. Twilio webhooks are secured by signature validation, not session-based authentication.
-   **Expenses Receipt Upload**: Handles receipt uploads to Google Cloud Storage.
-   **Dashboard Annual Goal Display**: Displays the organizational annual goal of 500,000 sandwiches.
-   **Social Media Graphics**: Supports image and PDF uploads to Google Cloud Storage with optional email notifications.
-   **Progressive Web App (PWA)**: Full PWA support enabling mobile installation, offline access, and real-time updates via a service worker and web app manifest.

## External Dependencies
-   **Database**: `@neondatabase/serverless`, `drizzle-orm`
-   **Web Framework**: `express`
-   **UI/Styling**: `@radix-ui`, `tailwindcss`, `lucide-react`, `class-variance-authority`, `shadcn/ui`
-   **Data Fetching/State**: `@tanstack/react-query`, `react-hook-form`, `zod`
-   **Email**: `@sendgrid/mail`
-   **Real-time Communication**: `socket.io`, `socket.io-client`
-   **PDF Generation**: `pdfkit`
-   **Authentication**: `connect-pg-simple`
-   **File Uploads**: `multer`
-   **Google Integration**: Google Sheets API, `@google-cloud/storage`, Google Analytics
-   **Mapping**: `leaflet@1.9.4`, `react-leaflet@4.2.1`, `react-leaflet-cluster`